var syncedInterval=setTimeout(function(){},1E3);function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}function getCookie(a){var b=null;if(document.cookie&&""!==document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(e.substring(0,a.length+1)===a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}
$.ajaxSetup({beforeSend:function(a,b){csrfSafeMethod(b.type)||this.crossDomain||(b=getCookie("csrftoken"),a.setRequestHeader("X-CSRFToken",b))}});$(document).ready(function(){console.log("Starting");setup()});function createRun(a,b){template='<div class="card"><div class="card-body" id="run-'+a+'"><p class="card-text text-muted empty-run">Bars will appear here.</p></div></div>';$("#project-"+b).append(template)}
function createBar(a){$("#run-"+a.run+" .empty-run").remove();var b="";a.comp?b=" bg-success":a.err&&(b=" bg-danger");b='<div class="row"><p class="col-2 mb-0">'+a.name+'</p><div class="col"><div class="progress"><div id="bar-'+a.id+'" class="progress-bar'+b+'" role="progressbar" style="width: '+a.perc+'%;" aria-valuenow="'+a.val+'" aria-valuemin="0" aria-valuemax="'+a.max+'">'+a.perc+"%</div></div></div></div>";$("#run-"+a.run).append(b)}
function updateDisplay(a){console.log(a);ts=a.ts;if("runs"in a){$(".empty-projects").remove();for(var b in a.runs)createRun(b,a.runs[b])}if("new"in a)for(var c in a["new"])createBar(a["new"][c]);for(var d in a.u)b=a.u[d],c=$("#bar-"+d),c.css("width",b.perc+"%"),c.prop("aria-valuenow",b.val),c.text(b.perc+"%"),"comp"in b?c.addClass("bg-success"):(c.removeClass("bg-success"),"err"in b?c.addClass("bg-danger"):c.removeClass("bg-danger"))}
function sync_status(){clearTimeout(syncedInterval);$("#sync-indicator").addClass("fa-spin");syncedInterval=setTimeout(function(){unspin()},1E3)}function unspin(){console.log("Unspinned");$("#sync-indicator").removeClass("fa-spin")}function check(){$.ajax({url:"/api/status/",dataType:"json",type:"get",data:{since:ts},success:updateDisplay})}function setup(){setInterval(function(){check()},1E3);check()};
